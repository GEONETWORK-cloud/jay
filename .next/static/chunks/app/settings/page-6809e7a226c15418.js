(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6938],{5942:function(e,t,s){Promise.resolve().then(s.bind(s,6832))},6832:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return p}});var a=s(7437),r=s(2265),i=s(7907),l=s(9),n=s(1441),c=s(2406),d=s(8121),o=s(4905),m=s(4499),x=s(1657),u=s(7815);function p(){let[e,t]=(0,r.useState)(!0),[s,p]=(0,r.useState)(!1),[h,g]=(0,r.useState)(null),[f,b]=(0,r.useState)(""),[y,j]=(0,r.useState)(null),[v,N]=(0,r.useState)("profile"),[w,k]=(0,r.useState)(""),[U,P]=(0,r.useState)(""),[S,C]=(0,r.useState)(!1),[E,A]=(0,r.useState)(null),L=(0,r.useRef)(null),[R,D]=(0,r.useState)(!1),F=(0,i.useRouter)(),{user:z}=(0,c.useAuth)(),J=e=>{if(!e)return"https://via.placeholder.com/150";let t=(0,u.createHash)("md5").update(e.toLowerCase().trim()).digest("hex");return"https://www.gravatar.com/avatar/".concat(t,"?s=150&d=mp")};(0,r.useEffect)(()=>{if(!z){F.push("/login");return}!async function(){if(z)try{t(!0),j(null);let e=(0,d.JU)(m.db,"users",z.uid),s=await (0,d.QT)(e),a=z.photoURL||(z.email?J(z.email):"");if(P(a),s.exists()){let e=s.data();g(e),b(e.displayName||""),D("public"===e.emailPrivacy),e.photoURL&&P(e.photoURL)}else{let e={email:z.email,displayName:"",emailPrivacy:"private",showEmail:!1,notifications:{email:!1,push:!1},privacy:{profileVisibility:"public",showActivity:!0},theme:"light",createdAt:new Date,updatedAt:new Date};await (0,d.pl)((0,d.JU)(m.db,"users",z.uid),e),g(e),b("")}}catch(e){console.error("Error loading user data:",e),j("Failed to load profile. Please try again later.")}finally{t(!1)}}()},[z,F]);let M=async e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];if(s){if(!["image/jpeg","image/png","image/gif"].includes(s.type)){(0,x.c0)("Please select a valid image file (JPEG, PNG, GIF)","error");return}if(s.size>5242880){(0,x.c0)("Image must be less than 5MB","error");return}try{C(!0);let e=(0,o.iH)(m.tO,"profile-images/".concat(null==z?void 0:z.uid,"_").concat(Date.now()));await (0,o.KV)(e,s);let t=await (0,o.Jt)(e);P(t),C(!1)}catch(e){console.error("Error uploading file:",e),(0,x.c0)("Failed to upload image","error"),C(!1)}}},_=async e=>{if(e.preventDefault(),!z){F.push("/login");return}try{p(!0),j(null);let e=(0,d.JU)(m.db,"users",z.uid);await (0,d.r7)(e,{displayName:f,photoURL:U,emailPrivacy:R?"public":"private",updatedAt:new Date}),(0,x.c0)("Profile updated successfully","success");let t=await (0,d.QT)(e);t.exists()&&g(t.data()),p(!1)}catch(e){console.error("Error saving profile:",e),j("Failed to update profile. Please try again."),p(!1)}};return z?(0,a.jsxs)("div",{className:"flex h-screen bg-gray-100",children:[(0,a.jsx)(n.Z,{}),(0,a.jsxs)("div",{className:"flex-1 overflow-auto p-6",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Settings"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Manage your account settings and preferences"})]}),y&&(0,a.jsxs)("div",{className:"mb-6 bg-red-100 border-l-4 border-red-500 text-red-700 p-4 flex items-start",children:[(0,a.jsx)(l.bcx,{className:"mt-0.5 mr-2 flex-shrink-0"}),(0,a.jsx)("span",{children:y})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[(0,a.jsx)("div",{className:"border-b border-gray-200",children:(0,a.jsx)("div",{className:"sm:flex sm:items-center",children:(0,a.jsx)("div",{className:"px-4 sm:px-6",children:(0,a.jsxs)("nav",{className:"-mb-px flex space-x-8",children:[(0,a.jsx)("button",{type:"button",onClick:()=>N("profile"),className:"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ".concat("profile"===v?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),title:"Profile settings","aria-label":"Profile settings",children:"Profile"}),(0,a.jsx)("button",{type:"button",onClick:()=>N("account"),className:"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ".concat("account"===v?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),title:"Account settings","aria-label":"Account settings",children:"Account"})]})})})}),e?(0,a.jsx)("div",{className:"p-8 flex justify-center",children:(0,a.jsx)("div",{className:"w-12 h-12 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin"})}):(0,a.jsxs)("div",{className:"p-4 sm:p-6",children:["profile"===v&&(0,a.jsxs)("form",{onSubmit:_,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Profile Image"}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row items-start gap-6",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsxs)("div",{className:"relative h-32 w-32 rounded-full overflow-hidden bg-gray-200 border border-gray-300",children:[U?(0,a.jsx)("img",{src:U,alt:"Profile Preview",className:"h-full w-full object-cover"}):(0,a.jsx)("div",{className:"h-full w-full flex items-center justify-center text-gray-400",children:(0,a.jsx)(l.fzv,{size:48})}),S&&(0,a.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:(0,a.jsx)("div",{className:"w-8 h-8 border-4 border-white border-t-transparent rounded-full animate-spin"})})]})}),(0,a.jsxs)("div",{className:"w-full space-y-4",children:[(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>A("url"),className:"flex items-center px-4 py-2 rounded-md ".concat("url"===E?"bg-indigo-100 text-indigo-700":"text-gray-700 hover:bg-gray-100"),title:"Use image URL","aria-label":"Use image URL",children:[(0,a.jsx)(l.XKb,{className:"mr-2"}),"Use URL"]}),(0,a.jsxs)("button",{type:"button",onClick:()=>{A("upload"),setTimeout(()=>{var e;return null===(e=L.current)||void 0===e?void 0:e.click()},100)},className:"flex items-center px-4 py-2 rounded-md ".concat("upload"===E?"bg-indigo-100 text-indigo-700":"text-gray-700 hover:bg-gray-100"),title:"Upload image","aria-label":"Upload image",children:[(0,a.jsx)(l.Yjd,{className:"mr-2"}),"Upload"]}),(0,a.jsx)("input",{type:"file",ref:L,onChange:M,className:"hidden",accept:"image/jpeg,image/png,image/gif",title:"Upload profile image"})]}),"url"===E&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("input",{type:"text",value:w,onChange:e=>k(e.target.value),placeholder:"Enter image URL",className:"flex-1 px-3 py-2 border rounded-l-md border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500"}),(0,a.jsx)("button",{type:"button",onClick:e=>{if(e.preventDefault(),w)try{new URL(w),P(w),k(""),A(null)}catch(e){(0,x.c0)("Please enter a valid URL","error")}},className:"px-4 py-2 bg-indigo-600 text-white rounded-r-md hover:bg-indigo-700",children:"Set"})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Enter a valid URL to an image (JPEG, PNG, GIF)"})]})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),(0,a.jsx)("button",{type:"button",onClick:()=>D(!R),className:"flex items-center space-x-2 px-3 py-2 rounded-lg ".concat(R?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),title:R?"Make email public":"Make email private","aria-label":R?"Make email public":"Make email private",children:R?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.rzC,{className:"mr-1",size:14}),(0,a.jsx)("span",{children:"Show email in profile"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.rDJ,{className:"mr-1",size:14}),(0,a.jsx)("span",{children:"Hide email in profile"})]})})]}),(0,a.jsxs)("div",{className:"flex items-center border rounded-lg px-3 py-2 bg-gray-50 text-gray-500",children:[(0,a.jsx)(l.Imn,{className:"mr-2"}),(0,a.jsx)("span",{children:null==z?void 0:z.email})]}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:R?"Your email will be hidden from other users":"Your email will be visible to other users"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"displayName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Display Name"}),(0,a.jsxs)("div",{className:"flex items-center border rounded-lg overflow-hidden",children:[(0,a.jsx)("div",{className:"bg-gray-50 p-2 text-gray-500",children:(0,a.jsx)(l.fzv,{})}),(0,a.jsx)("input",{id:"displayName",type:"text",value:f,onChange:e=>b(e.target.value),className:"block w-full px-3 py-2 outline-none",placeholder:"Enter your display name"})]}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"This name will be displayed to other users in the application"})]}),(0,a.jsx)("div",{children:(0,a.jsx)("button",{type:"submit",className:"bg-indigo-600 text-white px-4 py-2 rounded-lg flex items-center justify-center gap-2 hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:s,children:s?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,a.jsx)("span",{children:"Saving..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.mW3,{size:18}),(0,a.jsx)("span",{children:"Save Changes"})]})})})]}),"account"===v&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Account Settings"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Manage your account settings and preferences"})]}),(0,a.jsx)("div",{className:"border-t border-gray-200 pt-4",children:(0,a.jsx)("div",{className:"flex justify-between items-center",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:"Account Type"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:(null==h?void 0:h.role)==="admin"?"Administrator":"Standard User"})]})})}),(0,a.jsx)("div",{className:"border-t border-gray-200 pt-4",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:"Email Privacy"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:R?"Your email is hidden from other users":"Your email is visible to other users"})]}),(0,a.jsx)("div",{children:(0,a.jsx)("button",{type:"button",onClick:()=>{D(!R)},className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 ".concat(R?"bg-gray-200":"bg-indigo-600"),children:(0,a.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform ".concat(R?"translate-x-1":"translate-x-6")})})})]})}),(0,a.jsx)("div",{className:"border-t border-gray-200 pt-4",children:(0,a.jsx)("div",{className:"flex justify-between items-center",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:"Account Created"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:(null==h?void 0:h.createdAt)?new Date(h.createdAt).toLocaleDateString():"Unknown"})]})})})]})]})]})]})]}):null}}},function(e){e.O(0,[4358,5239,8218,201,8792,8156,127,2971,8069,1744],function(){return e(e.s=5942)}),_N_E=e.O()}]);