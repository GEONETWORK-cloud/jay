(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1931],{1593:function(e,t,r){Promise.resolve().then(r.bind(r,5981))},5981:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return b}});var s=r(7437),a=r(2265),i=r(7907),n=r(1441),c=r(9),l=r(1657);function o(e){let{stats:t,loading:r}=e,i=(0,a.useRef)(null),n=(0,a.useRef)(null);(0,a.useEffect)(()=>{!r&&(i.current&&(0,l.y0)(0,t.projectsCount,1e3,e=>{i.current&&(i.current.textContent=e.toString())}),n.current&&(0,l.y0)(0,t.activitiesCount,1e3,e=>{n.current&&(n.current.textContent=e.toString())}))},[t,r]);let o=e=>{switch(e){case"blue":return"bg-blue-100 text-blue-500";case"green":return"bg-green-100 text-green-500";case"purple":return"bg-purple-100 text-purple-500";case"orange":return"bg-orange-100 text-orange-500";default:return"bg-gray-100 text-gray-500"}},d=[{title:"Total Projects",value:t.projectsCount,ref:i,change:"+".concat(Math.floor(.08*t.projectsCount),"%"),icon:(0,s.jsx)(c.Qyq,{size:24}),color:"green"},{title:"Activities",value:t.activitiesCount,ref:n,change:"+".concat(Math.floor(.12*t.activitiesCount),"%"),icon:(0,s.jsx)(c.bAx,{size:24}),color:"orange"}];return(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-6",children:d.map((e,t)=>(0,s.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-gray-500 font-medium",children:e.title}),(0,s.jsx)("h3",{ref:e.ref,className:"text-2xl font-bold mt-1",children:r?(0,s.jsx)("div",{className:"h-7 w-16 bg-gray-200 animate-pulse rounded"}):e.value||"0"}),(0,s.jsx)("span",{className:"text-green-500 text-sm font-medium",children:r?(0,s.jsx)("div",{className:"h-4 w-12 bg-gray-200 animate-pulse rounded mt-1"}):e.change})]}),(0,s.jsx)("div",{className:"p-3 rounded-full ".concat(o(e.color)),children:e.icon})]})},t))})}var d=r(6136),u=r(1196);function m(e){let{chartData:t,loading:r}=e,[i,n]=(0,a.useState)("line"),c={labels:t.labels.length>0?t.labels:["Jan","Feb","Mar","Apr","May","Jun"],datasets:[{label:"Activities",data:t.data.length>0?t.data:[12,19,13,15,20,25],borderColor:"rgb(99, 102, 241)",backgroundColor:"rgba(99, 102, 241, 0.5)",fill:"line"===i,tension:.4}]};return r?(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Activity Overview"}),(0,s.jsx)("div",{className:"flex space-x-2",children:(0,s.jsx)("button",{className:"px-3 py-1 rounded bg-gray-200",children:"Loading..."})})]}),(0,s.jsx)("div",{className:"h-80 flex items-center justify-center",children:(0,s.jsx)("div",{className:"w-16 h-16 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin"})})]}):(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Activity Overview"}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)("button",{className:"px-3 py-1 rounded ".concat("line"===i?"bg-indigo-500 text-white":"bg-gray-200"),onClick:()=>n("line"),children:"Line"}),(0,s.jsx)("button",{className:"px-3 py-1 rounded ".concat("bar"===i?"bg-indigo-500 text-white":"bg-gray-200"),onClick:()=>n("bar"),children:"Bar"})]})]}),(0,s.jsx)("div",{className:"h-80",children:"line"===i?(0,s.jsx)(u.x1,{options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},title:{display:!0,text:"Activity Overview"},tooltip:{mode:"index",intersect:!1}},scales:{y:{beginAtZero:!0,grid:{display:!0}},x:{grid:{display:!1}}},interaction:{mode:"nearest",axis:"x",intersect:!1}},data:c}):(0,s.jsx)(u.$Q,{options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},title:{display:!0,text:"Activity Overview"},tooltip:{mode:"index",intersect:!1}},scales:{y:{beginAtZero:!0,grid:{display:!0}},x:{grid:{display:!1}}},interaction:{mode:"nearest",axis:"x",intersect:!1}},data:c})})]})}d.kL.register(d.uw,d.f$,d.od,d.jn,d.ZL,d.Dx,d.u,d.De,d.Gu);var x=r(6828);function g(e){let{activities:t,loading:r}=e,[i,n]=(0,a.useState)({});(0,a.useEffect)(()=>{async function e(){let e={};for(let r of t)e[r.userId]||(e[r.userId]=await (0,x.b3)(r.userId));n(e)}t.length>0&&e()},[t]);let o=e=>{if(e&&"object"==typeof e&&e.seconds&&e.nanoseconds){let t=new Date(1e3*e.seconds);return(0,l.BK)(t)}let t=Math.floor(60*Math.random())+1;return"".concat(t," ").concat(1===t?"minute":"minutes"," ago")},d=e=>{switch(e.toLowerCase()){case"create":return(0,s.jsx)(c.OvN,{size:16,className:"text-green-500"});case"update":return(0,s.jsx)(c.vPQ,{size:16,className:"text-blue-500"});case"delete":return(0,s.jsx)(c.Ybf,{size:16,className:"text-red-500"});case"view":return(0,s.jsx)(c.rDJ,{size:16,className:"text-purple-500"});case"login":return(0,s.jsx)(c._fJ,{size:16,className:"text-indigo-500"});case"logout":return(0,s.jsx)(c.xqh,{size:16,className:"text-orange-500"});default:return(0,s.jsx)(c.bAx,{size:16,className:"text-gray-500"})}},u=e=>"string"==typeof e?e:e&&"object"==typeof e&&e.name||"",m=e=>"string"==typeof e?"bg-gray-100":e&&"object"==typeof e&&e.color&&({blue:"bg-blue-100",green:"bg-green-100",purple:"bg-purple-100",orange:"bg-orange-100",red:"bg-red-100",yellow:"bg-yellow-100",indigo:"bg-indigo-100",pink:"bg-pink-100"})[e.color]||"bg-gray-100",g=e=>"string"==typeof e?"text-gray-600":e&&"object"==typeof e&&e.color&&({blue:"text-blue-600",green:"text-green-600",purple:"text-purple-600",orange:"text-orange-600",red:"text-red-600",yellow:"text-yellow-600",indigo:"text-indigo-600",pink:"text-pink-600"})[e.color]||"text-gray-600";return r?(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Recent Activity"}),(0,s.jsx)("div",{className:"space-y-4",children:[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,s.jsxs)("div",{className:"flex items-start animate-pulse",children:[(0,s.jsx)("div",{className:"w-10 h-10 bg-gray-200 rounded-full mr-3"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),(0,s.jsx)("div",{className:"h-3 bg-gray-200 rounded w-1/4"})]})]},t))})]}):(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Recent Activity"}),(0,s.jsx)("div",{className:"space-y-4",children:t.length>0?t.map(e=>(0,s.jsxs)("div",{className:"flex items-start",children:[(0,s.jsx)("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center mr-3",children:d(e.type)}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"text-sm",children:[(0,s.jsx)("span",{className:"font-medium",children:i[e.userId]||"User"})," ",e.description]}),(0,s.jsxs)("div",{className:"flex items-center mt-1",children:[(0,s.jsx)("p",{className:"text-xs text-gray-500",children:o(e.timestamp)}),e.tags&&e.tags.length>0&&(0,s.jsxs)("div",{className:"flex ml-2",children:[e.tags.slice(0,2).map((e,t)=>(0,s.jsx)("span",{className:"text-xs ".concat(m(e)," ").concat(g(e)," px-2 py-0.5 rounded-full ml-1"),children:u(e)},t)),e.tags.length>2&&(0,s.jsxs)("span",{className:"text-xs bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full ml-1",children:["+",e.tags.length-2]})]})]})]})]},e.id)):(0,s.jsx)("div",{className:"text-center py-6 text-gray-500",children:"No recent activity"})}),(0,s.jsx)("button",{className:"mt-4 text-indigo-600 text-sm hover:text-indigo-800",children:"View all activity →"})]})}var h=r(2406);function p(){let[e,t]=(0,a.useState)([]),[r,n]=(0,a.useState)(!0),[o,d]=(0,a.useState)("all"),{user:u}=(0,h.useAuth)(),m=(0,i.useRouter)(),g=e=>"string"==typeof e?e:e&&"object"==typeof e&&e.name||"";(0,a.useEffect)(()=>{async function e(){try{n(!0);let e=(await (0,x.He)()).map(e=>{var t;return{...e,id:null!==(t=e.id)&&void 0!==t?t:""}});t(e)}catch(e){console.error("Error loading projects:",e)}finally{n(!1)}}u&&e()},[u]);let p=async r=>{if(window.confirm("Are you sure you want to delete this project?"))try{await (0,x.th)(r),t(e.filter(e=>e.id!==r))}catch(e){console.error("Error deleting project:",e)}},f="all"===o?e:e.filter(e=>e.category===o),j=["all",...Array.from(new Set(e.map(e=>e.category)))],y=e=>{let t=document.getElementById("projects-container");t&&("left"===e?t.scrollLeft-=300:t.scrollLeft+=300)};return(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 overflow-hidden",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Recent Projects"}),(0,s.jsx)("div",{className:"flex space-x-2",children:j.map(e=>(0,s.jsx)("button",{className:"px-3 py-1 rounded text-sm ".concat(o===e?"bg-indigo-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),onClick:()=>d(e),title:"Filter by ".concat("all"===e?"all categories":(0,l.zk)(e)),children:"all"===e?"All":(0,l.zk)(e)},e))})]}),r?(0,s.jsx)("div",{className:"flex justify-center p-8",children:(0,s.jsx)("div",{className:"w-12 h-12 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin"})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("button",{className:"absolute left-0 top-1/2 transform -translate-y-1/2 bg-white rounded-full p-2 shadow z-10 hover:bg-gray-100",onClick:()=>y("left"),title:"Scroll left",children:(0,s.jsx)(c.YFh,{size:20})}),(0,s.jsx)("div",{id:"projects-container",className:"flex overflow-x-auto py-4 px-2 space-x-4 scrollbar-hide",style:{scrollBehavior:"smooth"},children:f.length>0?f.map(e=>(0,s.jsxs)("div",{className:"flex-shrink-0 w-72 bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden cursor-pointer hover:shadow-md transition-shadow",onClick:()=>m.push("/projects/".concat(e.id)),children:[(0,s.jsx)("div",{className:"h-36 overflow-hidden",children:(0,s.jsx)("img",{src:e.imageUrl||"https://via.placeholder.com/300x150?text=No+Image",alt:e.title,className:"w-full h-full object-cover"})}),(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-lg font-semibold",children:e.title}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:(0,l.zk)(e.category)})]}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)("button",{className:"text-blue-500 hover:text-blue-700",title:"Edit project",children:(0,s.jsx)(c.vPQ,{size:18})}),(0,s.jsx)("button",{className:"text-red-500 hover:text-red-700",onClick:()=>p(e.id),title:"Delete project",children:(0,s.jsx)(c.Ybf,{size:18})})]})]}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mt-2 line-clamp-2",children:e.description}),(0,s.jsxs)("div",{className:"mt-3 flex flex-wrap gap-1",children:[e.tags.slice(0,3).map((e,t)=>(0,s.jsx)("span",{className:"px-2 py-1 bg-gray-100 text-xs text-gray-600 rounded-full",children:g(e)},t)),e.tags.length>3&&(0,s.jsxs)("span",{className:"px-2 py-1 bg-gray-100 text-xs text-gray-600 rounded-full",children:["+",e.tags.length-3]})]}),(0,s.jsx)("div",{className:"mt-3 text-xs text-gray-500",children:(0,l.p6)(e.createdAt)})]})]},e.id)):(0,s.jsxs)("div",{className:"w-full text-center py-8 text-gray-500",children:["No projects found. ","all"!==o&&"Try changing the category filter."]})}),(0,s.jsx)("button",{className:"absolute right-0 top-1/2 transform -translate-y-1/2 bg-white rounded-full p-2 shadow z-10 hover:bg-gray-100",onClick:()=>y("right"),title:"Scroll right",children:(0,s.jsx)(c.Tfp,{size:20})})]}),(0,s.jsx)("div",{className:"mt-4 text-right",children:(0,s.jsxs)("button",{onClick:()=>m.push("/projects"),className:"text-indigo-600 hover:text-indigo-800 text-sm font-medium flex items-center justify-end space-x-1 ml-auto",title:"View all projects",children:[(0,s.jsx)("span",{children:"View all projects"}),(0,s.jsx)("span",{className:"text-lg",children:"→"})]})})]})]})}var f=r(8121),j=r(4499);function y(){let{user:e}=(0,h.useAuth)(),[t,r]=(0,a.useState)({projectsCount:0,activitiesCount:0,usersCount:0,recentActivities:[]}),[i,c]=(0,a.useState)([]),[d,u]=(0,a.useState)(!0),[y,b]=(0,a.useState)({labels:[],data:[]}),[v,w]=(0,a.useState)(""),[N,E]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{(async function(){if(e)try{let t=(0,f.JU)(j.db,"users",e.uid),r=await (0,f.QT)(t);if(r.exists()){let e=r.data();w(e.displayName||""),E(!1!==e.showEmail)}}catch(e){console.error("Error fetching user data:",e)}})()},[e]),(0,a.useEffect)(()=>{async function t(){try{u(!0);let e=await (0,x.OL)();r(e);let t=await (0,x.TC)(10);c(t);let s=(0,x.$B)(e.recentActivities);b(s)}catch(e){console.error("Error loading dashboard data:",e),(0,l.c0)("Failed to load dashboard data","error")}finally{u(!1)}}e&&t()},[e]),e)?(0,s.jsxs)("div",{className:"flex h-screen bg-gray-100",children:[(0,s.jsx)(n.Z,{}),(0,s.jsxs)("div",{className:"flex-1 overflow-auto p-6",children:[(0,s.jsxs)("header",{className:"mb-6",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-800",children:v?"Welcome back, ".concat(v):N&&(null==e?void 0:e.email)?"Welcome back, ".concat(e.email):"Welcome back"}),N&&e.email&&(0,s.jsx)("p",{className:"text-gray-600",children:e.email})]}),(0,s.jsx)(o,{stats:t,loading:d}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6",children:[(0,s.jsx)(m,{chartData:y,loading:d}),(0,s.jsx)(g,{activities:i,loading:d})]}),(0,s.jsx)("div",{className:"mt-6",children:(0,s.jsx)(p,{})})]})]}):null}function b(){let{user:e,loading:t}=(0,h.useAuth)(),r=(0,i.useRouter)();return((0,a.useEffect)(()=>{t||e||r.push("/login")},[t,e,r]),t)?(0,s.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,s.jsx)("div",{className:"w-16 h-16 border-t-4 border-b-4 border-indigo-600 rounded-full animate-spin"})}):e?(0,s.jsx)(y,{}):null}},6828:function(e,t,r){"use strict";r.d(t,{$B:function(){return x},$L:function(){return y},He:function(){return l},OL:function(){return d},TC:function(){return c},b3:function(){return u},e5:function(){return g},h8:function(){return j},j:function(){return p},p_:function(){return f},th:function(){return o},ty:function(){return h}});var s=r(4499),a=r(8121),i=r(1657);async function n(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];try{let n=(0,a.hJ)(s.db,"activities");await (0,a.ET)(n,{type:e,description:t,userId:r,timestamp:(0,a.Bt)(),tags:i}),console.log("Activity tracked successfully")}catch(e){throw console.error("Error tracking activity:",e),e}}async function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;try{let t=(0,a.hJ)(s.db,"activities"),r=(0,a.IO)(t,(0,a.Xo)("timestamp","desc"),(0,a.b9)(e));return(await (0,a.PL)(r)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){throw console.error("Error loading recent activities:",e),e}}async function l(){try{let e=(0,a.hJ)(s.db,"projects"),t=(0,a.IO)(e,(0,a.Xo)("createdAt","desc"));return(await (0,a.PL)(t)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){throw console.error("Error loading projects:",e),e}}async function o(e){try{return await (0,a.oe)((0,a.JU)(s.db,"projects",e)),(0,i.c0)("Project deleted successfully","success"),!0}catch(e){throw console.error("Error deleting project:",e),(0,i.c0)("Error deleting project","error"),e}}async function d(){try{let e=(0,a.IO)((0,a.hJ)(s.db,"projects")),t=(0,a.IO)((0,a.hJ)(s.db,"activities")),r=(0,a.IO)((0,a.hJ)(s.db,"users")),[i,n,c]=await Promise.all([(0,a.PL)(e),(0,a.PL)(t),(0,a.PL)(r)]),l=n.docs.map(e=>{let t=e.data();return{id:e.id,type:t.type,description:t.description,userId:t.userId,timestamp:t.timestamp instanceof a.EK?t.timestamp.toDate():new Date(t.timestamp)}}).sort((e,t)=>t.timestamp.getTime()-e.timestamp.getTime()).slice(0,5);return{projectsCount:i.size,activitiesCount:n.size,usersCount:c.size,recentActivities:l}}catch(e){throw console.error("Error loading dashboard stats:",e),e}}async function u(e){try{if("system"===e)return"System";let t=(0,a.JU)(s.db,"users",e),r=await (0,a.QT)(t);if(r.exists()){let e=r.data();if(e.email)return e.email;if(e.displayName)return e.displayName}return m(e)}catch(t){return console.error("Error getting user display name:",t),m(e)}}function m(e){let t=["gmail.com","outlook.com","yahoo.com","mail.com","example.com"],r=Math.abs(e.charCodeAt(0)+(e.charCodeAt(e.length-1)||0))%t.length,s=t[r],a="";if(e.length>20){let t=e.substring(0,2).toLowerCase(),r=e.substring(e.length-5).toLowerCase();a="user.".concat(t).concat(r)}else a="user.".concat(e.toLowerCase());return"".concat(a,"@").concat(s)}function x(e){let t={};e.forEach(e=>{if(!e.timestamp)return;let r=(e.timestamp instanceof a.EK?e.timestamp.toDate():new Date(e.timestamp)).toISOString().split("T")[0];t[r]?t[r]++:t[r]=1});let r=Object.keys(t).sort();return{labels:r.map(e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric"})),data:r.map(e=>t[e])}}async function g(e){try{let t=(0,a.JU)(s.db,"projects",e),r=await (0,a.QT)(t);if(r.exists())return{id:r.id,...r.data()};return null}catch(e){throw console.error("Error getting project:",e),(0,i.c0)("Error loading project details","error"),e}}async function h(e,t){try{let r=(0,a.JU)(s.db,"projects",e),n={...t,updatedAt:(0,a.Bt)()};return await (0,a.r7)(r,n),(0,i.c0)("Project updated successfully","success"),!0}catch(e){throw console.error("Error updating project:",e),(0,i.c0)("Error updating project","error"),e}}async function p(){try{let e=(0,a.hJ)(s.db,"activities"),t=(0,a.IO)(e,(0,a.Xo)("timestamp","desc"));return(await (0,a.PL)(t)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){throw console.error("Error loading all activities:",e),e}}async function f(){try{let e=(0,a.hJ)(s.db,"users");return(await (0,a.PL)(e)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){throw console.error("Error loading users:",e),e}}async function j(e){try{let t=(0,a.JU)(s.db,"users",e);if(!(await (0,a.QT)(t)).exists())throw Error("User not found");await (0,a.oe)(t);try{let t=await fetch("/api/users/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e})});if(!t.ok){let e=await t.json();console.error("Error from delete API:",e)}}catch(e){console.error("Error calling auth delete API:",e)}return await n("delete","Deleted a user account","system",["user","account","delete"]),(0,i.c0)("User deleted successfully","success"),!0}catch(e){throw console.error("Error deleting user:",e),(0,i.c0)("Error deleting user","error"),e}}async function y(e){try{let t=(0,a.Bt)(),r=(0,a.hJ)(s.db,"projects"),c={...e,createdAt:t,updatedAt:t},l=await (0,a.ET)(r,c),o=e.tags.map(e=>"string"==typeof e?e:e.name);return await n("create","Created a new project: ".concat(e.title),e.createdBy,["project","create",...o]),(0,i.c0)("Project created successfully","success"),l.id}catch(e){throw console.error("Error creating project:",e),(0,i.c0)("Error creating project","error"),e}}}},function(e){e.O(0,[4358,5239,8218,7674,201,8792,8156,1707,127,2971,8069,1744],function(){return e(e.s=1593)}),_N_E=e.O()}]);